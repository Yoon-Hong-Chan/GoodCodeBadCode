# 10.4 테스트 더블
- 단위 테스트는 '비교적 격리된 방식'으로 코드 단위를 테스트하는 것을 목표
- 테스트에서 의존성을 실제로 사용하는 것이 항상 가능하거나 바람직한 것만은 아님
- 의존성 실제 사용에 대안으로 테스트 더블이 있음
  - 목(mock)
  - 스텁(stub)
  - 페이크(fake)

## 10.4.1 테스트 더블을 사용하는 이유
- 테스트 더블을 사용해야 하는 일반적인 이유 세가지 
  - 테스트 단순화
    - 일부 의존성은 테스트에 사용하기 까다롭고 힘듬 -> 많은 설정 필요
    - 테스트 더블 활용 시, 실제 의존성 설정 하위 종속성 검증 비교적 간단히 세팅 가능
    - 또한 테스트 더 빠르게 실행 가능
  - 테스트로부터 외부 세계 보호
    - 일부 의존성은 실제로 부수 효과를 발생 -> 데이터를 실제 서버 요청으로 문제 발생
    - 이러한 부수 효과를 유발하는 테스트는 다음과 같은 문제 발생
      - 사용자는 이상하고 혼란스러운 값을 볼 수 있음: 테스트로 인해 운영에 이상한 값 반영
      - 모니터링 및 로깅에 영향을 미칠 수 있음: 오류 응답 테스트로 인해 모니터링 및 로깅에 오류로 잡힘
  - 외부로부터 테스트 보호:
    - 외부세계 비결정적에서 보호 -> 데이터 베이스 값의 변화로 인한 테스트 이상
- 의존성을 실제로 사용하는 것이 바람직하지 않거나 현실적으로 가능하지 않은 경우 존재

## 10.4.2 목 (테스트로부터 외부 세계 보호)
- 클래스나 인터페이스를 시뮬레이션하는 데 멤버 함수에 대한 호출을 기록하는 것 외 어떠한 일도 수행하지 않음
- 테스트 대상 코드에서 부수 효과를 일으키는 의존성을 시뮬레이션하는 데 가장 유용함
- verify를 통해 함수 호출에 대한 여부 확인\
![img_2.png](img_2.png)
- 외부 세계를 보호하는 데는 성공, But 테스트가 비현실적이고 중요한 버그를 잡지 못할 위험이 존재

## 10.4.3 스텁 (외부 세계로부터 테스트 보호)
- 함수가 호출되면 미리 정해 놓은 값을 반환함으로써 함수를 시뮬레이션함
- 대상 코드가 의존하는 코드로부터 어떤 값을 받아야 하는 경우 그 의존성을 시뮬레이션하는 데 유용
- 목과 스텁 사이에는 분명한 차이가 존재, But 개발자들이 일상적으로 목이라고 지칭(junit에서도 같이 활용)
- 테스트를 외부로부터 보호하고 결과를 신뢰할 수 있음

## 10.4.4 목과 스텁은 문제가 될 수 있다
- 목과 스텁은 2가지 단점 존재
  - 목이나 스텁이 실제 의존성과 다른 방식으로 동작되도록 설정할 수 있음 -> 테스트가 실제적이지 않음
    - 실제 값이 리턴된다는 가정을 하였지만 특정 값에 대해 Exception 일어날 수 도 있음
    - 실제 의존성이 어떻게 동작하는지 이해못하면 실수 가능성이 높음
  - 구현 세부 사항과 테스트가 밀접하게 결합하여 리팩토링이 어려워질 수 있음
    - 실제 이슈가 있어 분기처리를 통해 기존 함수를 호출하지 않는 쪽으로 변경 -> 관련 테스트 코드 전체 수정
    - 테스트는 구현 세부 사항에 구애받지 않아야 하지만...
- 필자는 목과 스텁을 최소한으로 사용하는 것이 최선이라 생각함 -> 실제 의존성이나 페이크 사용하는 것이 보통 더 바람직함


